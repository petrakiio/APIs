<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vale Ler</title>
    <link rel="stylesheet" href="../static/style.css">
    <link rel="shortcut icon" href="../static/img/valeLer.png" type="image/x-icon">
</head>
<body>

<nav class="navbar">
    <div class="nav-brand">ðŸ“š Biblioteca</div>
    <ul class="nav-links">
        <li><a href="/add_livros">Adicionar livros</a></li>
        <li><a href="/emprestimo">Emprestar livros</a></li>
        <li><a href="/editar">Editar livros</a></li>
        <li><a href="/deletar">Remover Livros</a></li>
    </ul>
    <div class="nav-user">
        <span>Admin</span>
    </div>
</nav>

<h2>ðŸ“˜ Livros Cadastrados</h2>

<div class="search-bar">
    <form id="search-form">
        <input id="search-input" type="text" name="q" placeholder="Pesquisar por nome do livro..." />
        <button type="submit">Pesquisar</button>
    </form>
</div>

<div id="search-result" class="search-result"></div>

<table>
    <thead>
        <tr>
            <th>ID</th>
            <th>TÃ­tulo</th>
            <th>Autor</th>
            <th>Editora</th>
            <th>Ano</th>
            <th>ISBN</th>
            <th>Categoria</th>
            <th>Total de Unidades</th>
            <th>Unidades DisponÃ­veis</th>
            <th>Data de Cadastro</th>
        </tr>
    </thead>
    <tbody>
        {% for livro in livros %}
        <tr>
            <td>{{ livro.id_livro }}</td>
            <td>{{ livro.titulo }}</td>
            <td>{{ livro.autor }}</td>
            <td>{{ livro.editora }}</td>
            <td>{{ livro.ano_publicacao }}</td>
            <td>{{ livro.isbn }}</td>
            <td>{{ livro.categoria }}</td>
            <td>{{ livro.total_unidades }}</td>
            <td>{{ livro.unidades_disponiveis }}</td>
            <td>{{ livro.data_cadastro }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<h2>ðŸ“• Livros Emprestados</h2>

<table>
    <thead>
        <tr>
            <th>ID EmprÃ©stimo</th>
            <th>Livro</th>
            <th>Nome da Pessoa</th>
            <th>Data do EmprÃ©stimo</th>
            <th>Data de DevoluÃ§Ã£o</th>
            <th>Valor</th>
            <th>AÃ§Ã£o</th>
        </tr>
    </thead>
    <tbody>
        {% for emprestimo in emprestimos %}
        <tr>
            <td>{{ emprestimo.id_emprestimo }}</td>
            <td>{{ emprestimo.titulo }}</td>
            <td>{{ emprestimo.nome_pessoa }}</td>
            <td>{{ emprestimo.data_emprestimo }}</td>
            <td>{{ emprestimo.data_devolucao }}</td>
            <td>R$ {{ emprestimo.valor }}</td>
            <td>
                <form method="POST" action="/devolver/{{ emprestimo.id_emprestimo }}">
                    <input type="hidden" name="id_emprestimo" value="{{ emprestimo.id_emprestimo }}">
                    <button type="submit" class="btn-devolver">
                        Devolver
                    </button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>


</body>
<script>
const form = document.getElementById('search-form');
const input = document.getElementById('search-input');
const resultBox = document.getElementById('search-result');

form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const q = input.value.trim();
    if (!q) {
        resultBox.textContent = 'Digite um nome para pesquisar.';
        return;
    }

    try {
        const res = await fetch(`/search_books?q=${encodeURIComponent(q)}`);
        const data = await res.json();

        if (!data || Object.keys(data).length === 0) {
            resultBox.textContent = 'Nenhum livro encontrado.';
            return;
        }

        resultBox.innerHTML = `
            <div class="result-card">
                <div><strong>ID:</strong> ${data.id_livro}</div>
                <div><strong>TÃ­tulo:</strong> ${data.titulo}</div>
                <div><strong>Autor:</strong> ${data.autor}</div>
                <div><strong>Editora:</strong> ${data.editora ?? '-'}</div>
                <div><strong>Ano:</strong> ${data.ano_publicacao ?? '-'}</div>
                <div><strong>ISBN:</strong> ${data.isbn ?? '-'}</div>
                <div><strong>Categoria:</strong> ${data.categoria ?? '-'}</div>
                <div><strong>Total:</strong> ${data.total_unidades}</div>
                <div><strong>DisponÃ­veis:</strong> ${data.unidades_disponiveis}</div>
            </div>
        `;
    } catch (err) {
        resultBox.textContent = 'Erro ao buscar livros.';
    }
});
</script>
</html>
